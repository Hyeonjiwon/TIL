### 조인(Join)
- 관계형 DB에서 가장 기본, 중요한 기능
- 두개 이상의 테이블을 서로 연결하여 데이터 추출
- 많이 할 수록 성능 저하

#### 조인 시 데이터 집합 레벨의 변화 이해
- 1:M 조인 - 결과 집합은 M 집합의 레벨을 그대로 유지

#### 실습
```sql
-- 직원 정보와 직원이 속한 부서명을 가져오기
SELECT A.*, B.DNAME 
FROM HR.EMP A
JOIN HR.DEPT B ON A.DEPTNO = B.DEPTNO;

-- job이 SALESMAN인 직원정보와 직원이 속한 부서명을 가져오기. 
SELECT  A.*, B.DNAME 
FROM HR.EMP A
	JOIN HR.DEPT B ON A.DEPTNO = B.DEPTNO 
WHERE A.JOB = 'SALESMAN';

-- 부서명 SALES와 RESEARCH의 소속 직원들의 부서명, 직원번호, 직원명, JOB 그리고 과거 급여 정보 추출

-- 1
SELECT B.DNAME, A.EMPNO, A.ENAME, A.JOB, C.FROMDATE, C.TODATE, C.SAL
FROM HR.EMP A
	JOIN HR.DEPT B ON A.DEPTNO = B.DEPTNO 
	JOIN HR.EMP_SALARY_HIST C ON A.EMPNO = C.EMPNO
WHERE B.DNAME IN ('SALES', 'RESEARCH');

-- 2
SELECT A.DNAME, B.EMPNO, B.ENAME, B.JOB, C.FROMDATE, C.TODATE, C.SAL
FROM HR.DEPT A
	JOIN HR.EMP B ON A.DEPTNO = B.DEPTNO 
	JOIN HR.EMP_SALARY_HIST C ON B.EMPNO = C.EMPNO
WHERE A.DNAME IN ('SALES', 'RESEARCH');

-- > 집합 레벨은 마지막에 join한 EMP_SALARY_HIST를 따라감
-- 조인 순서와 실행속도 차이 질문 

-- 부서명 SALES와 RESEARCH의 소속 직원들의 부서명, 직원번호, 직원명, JOB 그리고 과거 급여 정보중 1983년 이전 데이터는 무시하고 데이터 추출 
SELECT A.DNAME, B.EMPNO, B.ENAME, B.JOB, C.FROMDATE, C.TODATE, C.SAL
FROM HR.DEPT A
	JOIN HR.EMP B ON A.DEPTNO = B.DEPTNO 
	JOIN HR.EMP_SALARY_HIST C ON B.EMPNO = C.EMPNO
WHERE 1=1
AND A.DNAME IN ('SALES', 'RESEARCH')
AND C.FROMDATE >= TO_DATE('19830101', 'yyyymmdd')
ORDER BY 1, 2, 3, C.FROMDATE;

-- > 컬럼명 대신 숫자값을 지정하여 order by. 숫자값은 select 절에 사용된 컬럼명들을 순서대로 지정한 것

-- 부서명 SALES와 RESEARCH 소속 직원별로 과거부터 현재까지 모든 급여를 취합한 평균 급여
SELECT B.EMPNO, B.ENAME, AVG(C.SAL) 
FROM HR.DEPT A
	JOIN HR.EMP B ON A.DEPTNO = B.DEPTNO
	JOIN HR.EMP_SALARY_HIST C ON B.EMPNO = C.EMPNO
WHERE 1=1
AND A.DNAME IN ('SALES', 'RESEARCH')
GROUP BY B.EMPNO;


-- with 절 사용
WITH 
TEMP_01 as
(
SELECT A.DNAME, B.EMPNO, B.ENAME, B.JOB, C.FROMDATE, C.TODATE, C.SAL
FROM HR.DEPT A
	JOIN HR.EMP B ON A.DEPTNO = B.DEPTNO 
	JOIN HR.EMP_SALARY_HIST C ON B.EMPNO = C.EMPNO
WHERE 1=1
AND A.DNAME IN ('SALES', 'RESEARCH')
ORDER BY A.DNAME, B.EMPNO, C.FROMDATE
)
SELECT EMPNO, MAX(ENAME) AS ENAME, AVG(SAL) AS AVG_SAL
FROM TEMP_01
group BY EMPNO;


-- 직원명 SMITH의 과거 소속 부서 정보를 구할 것. 
SELECT A.ENAME, A.EMPNO, B.DEPTNO, C.DNAME, B.FROMDATE, B.TODATE
FROM HR.EMP A
	JOIN HR.EMP_DEPT_HIST B ON A.EMPNO = B.EMPNO
	JOIN HR.DEPT C ON B.DEPTNO = C.DEPTNO
```